<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OGforge — Download</title>
    <meta name="theme-color" content="#0b0b10" />
    <link rel="icon" href="logo.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="wrap">
      <header class="hero">
        <img class="logo" src="logo.svg" alt="OGforge logo" />
        <div>
          <h1>OGforge</h1>
          <p class="sub">Mine. Upgrade. Survive. Your worlds save as files on your computer.</p>
        </div>
      </header>

      <section class="card">
        <h2>Download</h2>
        <p id="status" class="status">Choose your platform.</p>
        <p id="ver" class="status" style="opacity:.8;margin-top:-6px">Loading latest version…</p>

        <div class="buttons">
          <a id="dl-win" class="btn" href="downloads/OGforge.exe" download>Download for Windows (.exe)</a>
          <a id="dl-mac" class="btn" href="downloads/OGforge.dmg" download>Download for macOS (.dmg)</a>
          <a id="dl-mac-zip" class="btn ghost" href="downloads/OGforge-mac.zip" download>Download macOS (.zip)</a>
        </div>

        <div class="fine">
          <p><span class="k">Windows</span> Run the `.exe`.</p>
          <p><span class="k">macOS</span> Open the `.dmg` and drag `OGforge.app` into Applications (or use the zip if you prefer).</p>
        </div>

        <div class="actions">
          <span class="muted">Tip: On macOS, open the .dmg and drag the app into Applications.</span>
        </div>
      </section>

      <footer class="foot">
        <span>OGforge</span>
        <span class="dot">•</span>
        <span class="muted">Black &amp; grey theme</span>
      </footer>
    </main>

    <script>
      (function () {
        const statusEl = document.getElementById('status');
        const verEl = document.getElementById('ver');
        const winBtn = document.getElementById('dl-win');
        const macBtn = document.getElementById('dl-mac');
        const macZipBtn = document.getElementById('dl-mac-zip');
        const ua = navigator.userAgent || '';
        const isWindows = /Windows/i.test(ua);
        const isMac = /Macintosh|Mac OS X|Mac_PowerPC|MacIntel/i.test(ua) && !isWindows;
        if (isWindows) statusEl.textContent = 'Detected Windows — click “Download for Windows”.';
        else if (isMac) statusEl.textContent = 'Detected macOS — click “Download for macOS”.';

        fetch('version.json', { cache: 'no-store' })
          .then((r) => (r.ok ? r.json() : null))
          .then((j) => {
            const v = j && j.version ? String(j.version) : null;
            if (v) verEl.textContent = `Latest version: v${v}`;
            const w = j && j.downloads && j.downloads.win ? String(j.downloads.win) : null;
            const m = j && j.downloads && j.downloads.mac ? String(j.downloads.mac) : null;
            if (w) winBtn.href = `${w}?v=${encodeURIComponent(v || '')}`;
            if (m) macBtn.href = `${m}?v=${encodeURIComponent(v || '')}`;
            if (m && macZipBtn) macZipBtn.href = 'downloads/OGforge-mac.zip';
          })
          .catch(() => {
            verEl.textContent = 'Latest version: unknown';
          });
      })();
    </script>
  </body>
</html>
